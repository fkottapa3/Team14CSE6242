<!DOCTYPE html>

<head>
  <title>Line Charts</title>
  <meta charset="utf-8">

  <script type="text/javascript" src="../lib/d3.v5.min.js"></script>

</head>

<body>
  <div id='signature'>fkottapa3</div>
  <div id='chart'></div>

	<script>
		const margin = { top: 50, right: 50, bottom: 50, left: 60 },
         		       width = 800 - margin.left - margin.right,
         	              height = 400 - margin.top - margin.bottom;
		
		       const svg = d3.select("#chart")
		      .append("svg")
		      .attr("width", width + margin.left + margin.right)
		      .attr("height", height + margin.top + margin.bottom)
		      .append("g")
		      .attr("transform", `translate(${margin.left},${margin.top})`);
		
		const color = d3.scaleOrdinal(d3.schemeCategory10);
		
		const xScale = d3.scaleTime().range([0, width]);
		const yScale = d3.scaleLinear().range([height, 0]);
		
		const line = d3.line()
		      .x(d => xScale(d.date))
		      .y(d => yScale(d.ratings));
		
		d3.csv("boardgame_ratings.csv").then(data => {
		       const parseTime = d3.timeParse("%Y-%m-%d");
		
		       let games = ["Catan", "Dominion", "Codenames", "Terraforming Mars", 
    	                   "Gloomhaven", "Magic: The Gathering", "Dixit", "Monopoly"];
		
		       let formattedData = games.map(game => {
		        return {
			          name: game,
			          values: data.map(d => ({
			            date: parseTime(d.Date),
			            ratings: +d[game]
			          }))
		        };
		     });
		
		     xScale.domain(d3.extent(data, d => parseTime(d.Date)));
		     yScale.domain([0, d3.max(formattedData, g => d3.max(g.values, v => v.ratings))]);
		
		     const xAxis = d3.axisBottom(xScale)
		        .ticks(d3.timeMonth.every(3))
		        .tickFormat(d3.timeFormat("%b %y"));
		
		     const yAxis = d3.axisLeft(yScale);				
			 svg.append("g")
				 .attr("transform", `translate(0, ${height})`)
				 .call(xAxis);
		 
			 svg.append("g")
				 .call(yAxis);
		 
			 svg.selectAll(".line")
				 .data(formattedData)
				 .enter()
				 .append("path")
				 .attr("class", "line")
				 .attr("fill", "none")
				 .attr("stroke", d => color(d.name))
				 .attr("stroke-width", 2)
				 .attr("d", d => line(d.values));
		 
			 svg.selectAll(".text")
				 .data(formattedData)
				 .enter()
				 .append("text")
				 .attr("transform", d => {
				 let lastPoint = d.values[d.values.length - 1];
				 return `translate(${xScale(lastPoint.date)},${yScale(lastPoint.ratings)})`;
				 })
				 .attr("dy", "0.35em")
				 .attr("x", 5)
				 .style("font-size", "12px")
				 .style("fill", d => color(d.name))
				 .text(d => d.name);
		 
			 svg.append("text")
				 .attr("x", width / 2)
				 .attr("y", -20)
				 .attr("text-anchor", "middle")
				 .style("font-size", "16px")
				 .text("Number of Ratings 2016-2020");
		 
			 svg.append("text")
				 .attr("x", width / 2)
				 .attr("y", height + 40)
				 .attr("text-anchor", "middle")
				 .style("font-size", "14px")
				 .text("Month");
		 
			 svg.append("text")
				 .attr("transform", "rotate(-90)")
				 .attr("x", -height / 2)
				 .attr("y", -40)
				 .attr("text-anchor", "middle")
				 .style("font-size", "14px")
				 .text("Num of Ratings");
			 });
					 

 	</script>
</body>
